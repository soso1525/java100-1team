<div class="modal-header">
</div>
<div class="modal-body">
	<form>
		<div class='form-group row my-view'>
			<div class='col-sm-10'>
				<input class='form-control' id='ano' type='hidden'name='ano'>
			</div>
		</div>
		<div class='title form-group row'>
			<label for='education' class='col-sm-10 col-form-label modal-title'>기업명</label>
			<div class='col-sm-5'>
				<input class='form-control' id='aname' type='text' name='aname'>
			</div>
		</div>

		<div class='form-group row'>
			<div class='col-sm-10'>
				<button id="addBtn" type="button"
					class='btn btn-primary btn-sm my-new'>추가</button>
				<button id="updateBtn" type="button"
					class='btn btn-primary btn-sm my-view'>변경</button>
				<button id="deleteBtn" type="button"
					class='btn btn-primary btn-sm my-view'>삭제</button>
			</div>
		</div>
	</form>

	<div class="row">
        <div class="col-md-12">
			<ul class="portfolio">
                <li class="filter" data-filter="all">자소서</li>
            </ul>
        </div>
    	<div class="portfolio-inner margin-top-30" id ="letterList"></div>
    </div>
    
    
	<button id="letterBtn" type="button"
		class='btn btn-primary btn-sm my-view'>추가</button>
	<table id='testList' class='table table-hover my-view'>
		<thead>
			<tr>
				<th>유형</th>
				<th>날짜</th>
				<th>시간</th>
				<th>위치</th>
				<th>준비물</th>
				<th>합격여부</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<button id="testBtn" type="button"
		class='btn btn-primary btn-sm my-view'>추가</button>
</div>

<div class="modal-footer">
	<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	<button type="button" class="btn btn-primary">Save changes</button>
</div>
<script type="text/javascript">
var addBtn = $('#addBtn'),
	updateBtn = $('#updateBtn'),
	deleteBtn = $('#deleteBtn'),
	letterBtn = $('#letterBtn'),
	testBtn = $('#testBtn'),
	anameItem = $('#aname'),
	letterListItem = $('#letterList'),
	anoItem = $('#ano'), 
	testTbody = document.querySelector('#testList > tbody');
	
function view(value) {
	index = value;
	if (index != -1) {
		$('.my-new').css('display','none');
		$(() => {
		    $.ajax('../json/apply/' + index, {
		        dataType: 'json',
		        success: (result) => {
		        	anoItem.val(result.data.ano);
		            anameItem.val(result.data.aname);
		            letterListItem.html("");
		            for (var data of result.letter) {
						var div = $("<div class='col-md-2 col-sm-3 letter'></div>");
						div.html(
							"<div class='services-detail'>" +
								"<i class='icon-notebook color-7'></i>" +
								"<h5>" + data.lno + "</h5>" +
							"</div>");
				        letterListItem.append(div);
					}
		            testTbody.innerHTML = "";
		            for (var data of result.test) {
		            	var typeName;
		            	if (data.type == 0) {
		            		typeName = "인적성";
		            	} else {
		            		typeName = "면접";
		            	} 
		            	
		            	var checkName;
		            	if (data.check == 0) {
		            		checkName = "불합격";
		            	} else if (data.check == 1) {
		            		checkName = "합격";
		            	} else {
		            		checkName = "대기";
		            	}
						var tr = document.createElement('tr');
						tr.innerHTML = 
				      	//"<td><a href='../test/form.html?no=" + data.no + "'>" + data.no + "</a></td>" +
				      	"<td>" + typeName + "</td>" +
				      	"<td>" + data.date + "</td>" +
				      	"<td>" + data.time + "</td>" +
				        "<td>" + data.location + "</td>" +
				      	"<td>" + data.prepare + "</td>" +
				      	"<td>" + checkName + "</td>";
				        testTbody.appendChild(tr);
					}
		        },
		        error: () => {
		            window.alert('서버 실행 오류!');
		        }
		    });
		});
	} else { // 신규 데이터 입력일 경우,
		$('.my-view').css('display', 'none');
	}

	addBtn.click(() => {
		$.ajax('../json/apply/add', {
		    data: {
		        aname: anameItem.val()
		    },
		    dataType: 'json',
		    method: 'POST',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});


	updateBtn.click(() => {
		$.ajax('../json/apply/update', {
		    data: {
		        ano: anoItem.val(),
		        aname: anameItem.val()
		    },
		    dataType: 'json',
		    method: 'POST',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});

	deleteBtn.click(() => {
		$.ajax('../json/apply/delete', {
		    data: {
		        ano: anoItem.val()
		    },
		    dataType: 'json',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});

	letterBtn.click(() => {
		$.ajax({
		    method: 'POST',
		    success: (result) => {
		        location.href = "../letter/form.html?ano=" + index;
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});


	testBtn.click(() => {
		$.ajax({
		    method: 'POST',
		    success: (result) => {
		        location.href = "../test/form.html?ano=" + index;
		    }, 
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});
	
}
</script>

</html>