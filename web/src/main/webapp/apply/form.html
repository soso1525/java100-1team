<div class="modal-header">
	<h5 style="margin-top: 30px; margin-bottom: 30px">기업 추가</h5>
</div>
<div class="modal-body">
	<form>
		<div class='form-group row my-view'>
			<label for='no' class='col-sm-2 col-form-label'>번호</label>
			<div class='col-sm-10'>
				<input class='form-control' readonly id='ano' type='number'
					name='ano'>
			</div>
		</div>
		<div class='form-group row'>
			<label for='education' class='col-sm-2 col-form-label'>기업명</label>
			<div class='col-sm-10'>
				<input class='form-control' id='aname' type='text' name='aname'>
			</div>
		</div>

		<div class='form-group row'>
			<div class='col-sm-10'>
				<button id="addBtn" type="button"
					class='btn btn-primary btn-sm my-new'>추가</button>
				<button id="updateBtn" type="button"
					class='btn btn-primary btn-sm my-view'>변경</button>
				<button id="deleteBtn" type="button"
					class='btn btn-primary btn-sm my-view'>삭제</button>
			</div>
		</div>
	</form>

	<table id='letterList' class='table table-hover my-view'>
		<thead>
			<tr>
				<th>번호</th>
				<th>저장일시</th>
				<th>마감일</th>
				<th>제출여부</th>
				<th>합격여부</th>
				<th>지원회사</th>
				<th>첨삭완료된파일</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<button id="letterBtn" type="button"
		class='btn btn-primary btn-sm my-view'>추가</button>
	<table id='testList' class='table table-hover my-view'>
		<thead>
			<tr>
				<th>번호</th>
				<th>유형</th>
				<th>날짜</th>
				<th>시간</th>
				<th>위치</th>
				<th>준비물</th>
				<th>합격여부</th>
			</tr>
		</thead>
		<tbody></tbody>
	</table>
	<button id="testBtn" type="button"
		class='btn btn-primary btn-sm my-view'>추가</button>
</div>

<div class="modal-footer">
	<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
	<button type="button" class="btn btn-primary">Save changes</button>
</div>
<script type="text/javascript">
var addBtn = $('#addBtn'),
	updateBtn = $('#updateBtn'),
	deleteBtn = $('#deleteBtn'),
	letterBtn = $('#letterBtn'),
	testBtn = $('#testBtn'),
	anameItem = $('#aname'),
	anoItem = $('#ano'), 
	letterTbody = document.querySelector('#letterList > tbody'),
	testTbody = document.querySelector('#testList > tbody');
	
function view(value) {
	index = value;
	if (index != -1) {
		$('.my-new').css('display','none');
		$(() => {
		    $.ajax('../json/apply/' + index, {
		        dataType: 'json',
		        success: (result) => {
		        	anoItem.val(result.data.ano);
		            anameItem.val(result.data.aname);
		            letterTbody.innerHTML = "";
		            for (var data of result.letter) {
						var tr = document.createElement('tr');
						tr.innerHTML = 
				      	"<td><a href='../letter/view.html?no=" + data.lno + "'>" + data.lno + "</a></td>" +
				      	"<td>" + data.lsdt + "</td>" +
				      	"<td>" + data.ledt + "</td>" +
				      	"<td>" + data.lscheck + "</td>" +
				        "<td>" + data.lpcheck + "</td>" +
				      	"<td>" + data.apply.aname + "</td>" +
				      	"<td>" + data.lfile + "</td>";
				        letterTbody.appendChild(tr);
					}
		            testTbody.innerHTML = "";
		            for (var data of result.test) {
		            	var typeName;
		            	if (data.type == 0) {
		            		typeName = "인적성";
		            	} else {
		            		typeName = "면접";
		            	}
		            	
		            	var checkName;
		            	if (data.check == 0) {
		            		checkName = "불합격";
		            	} else if (data.check == 1) {
		            		checkName = "합격";
		            	} else {
		            		checkName = "대기";
		            	}
						var tr = document.createElement('tr');
						tr.innerHTML = 
				      	"<td><a href='../test/form.html?no=" + data.no + "'>" + data.no + "</a></td>" +
				      	"<td>" + typeName + "</td>" +
				      	"<td>" + data.date + "</td>" +
				      	"<td>" + data.time + "</td>" +
				        "<td>" + data.location + "</td>" +
				      	"<td>" + data.prepare + "</td>" +
				      	"<td>" + checkName + "</td>";
				        testTbody.appendChild(tr);
					}
		        },
		        error: () => {
		            window.alert('서버 실행 오류!');
		        }
		    });
		});
	} else { // 신규 데이터 입력일 경우,
		$('.my-view').css('display', 'none');
	}

	addBtn.click(() => {
		$.ajax('../json/apply/add', {
		    data: {
		        aname: anameItem.val()
		    },
		    dataType: 'json',
		    method: 'POST',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});


	updateBtn.click(() => {
		$.ajax('../json/apply/update', {
		    data: {
		        ano: anoItem.val(),
		        aname: anameItem.val()
		    },
		    dataType: 'json',
		    method: 'POST',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});

	deleteBtn.click(() => {
		$.ajax('../json/apply/delete', {
		    data: {
		        ano: anoItem.val()
		    },
		    dataType: 'json',
		    success: (result) => {
		        location.href = "list.html";
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});

	letterBtn.click(() => {
		$.ajax({
		    method: 'POST',
		    success: (result) => {
		        location.href = "../letter/form.html?ano=" + index;
		    },
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});


	testBtn.click(() => {
		$.ajax({
		    method: 'POST',
		    success: (result) => {
		        location.href = "../test/form.html?ano=" + index;
		    }, 
		    error: () => {
		        window.alert('서버 실행 오류!');
		    }
		});
	});
	
}
</script>

</html>