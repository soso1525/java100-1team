
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>catch</title>
<link rel='stylesheet'
	href='../node_modules/bootstrap/dist/css/bootstrap.min.css'>
<link rel='stylesheet' href='../css/common.css'>
</head>
<body>
	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<a class="navbar-brand" href="../member/list.html">CATCH</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse"
			data-target="#navbarNav" aria-controls="navbarNav"
			aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNav">
			<ul class="navbar-nav">
				<li class="nav-item active"><a class="nav-link" href="#">Job</a></li>
				<li class="nav-item"><a class="nav-link"
					href="../study/list.html">Study</a></li>
				<li class="nav-item"><a class="nav-link"
					href="../apply/list.html">Apply</a></li>
				<li class="nav-item"><a class="nav-link" href="../notice/list.html">Notice</a></li>
				<li class="nav-item"><a class="nav-link" href="#">Message</a></li>
				<li class="nav-item"><a class="nav-link"
					href="../app/auth/login">Login</a></li>
			</ul>
		</div>
	</nav>

	<div class='container'>
		<h1>인적성/면접 일정 등록</h1>
		<form action='add' method='post'>
			<input type="hidden" name="ano" id="ano">
			<input type="hidden" name="no" id="no">
			<div class='form-group row'>
				<div class="form-check form-check-inline">
					<input class="form-check-input" type="radio" name="type" id="type1"> <label class="form-check-label" for="type1">인적성</label>
				</div>
				<div class="form-check form-check-inline">
					<input class="form-check-input" type="radio" name="type" id="type2"> <label class="form-check-label" for="type2">면접</label>
				</div>
			</div>

			<div class='form-group row'>
				<label for='date' class='col-sm-2 col-form-label'>날짜</label>
				<div class='col-sm-10'>
					<input class='form-control' id='date' type='date' name='date'>
				</div>
			</div>

			<div class='form-group row'>
				<label for='time' class='col-sm-2 col-form-label'>시간</label>
				<div class='col-sm-10'>
					<input class='form-control' id='time' type='time' name='time'>
				</div>
			</div>

			<div class='form-group row'>
				<label for='location' class='col-sm-2 col-form-label'>장소</label>
				<div class='col-sm-10'>
					<input class='form-control' id='location' type='text'
						name='location'>
				</div>
			</div>

			<div class='form-group row'>
				<label for='prepare' class='col-sm-2 col-form-label'>준비물</label>
				<div class='col-sm-10'>
					<input class='form-control' id='prepare' type='text' name='prepare'>
				</div>
			</div>
			
			<div class='form-group row my-view'>
				<label for='prepare' class='col-sm-2 col-form-label'>합격여부</label>
				<div class="form-check form-check-inline">
					<input class="form-check-input" type="radio" name="check" id="check1"> <label class="form-check-label" for="check1">불합격</label>
				</div>
				<div class="form-check form-check-inline">
					<input class="form-check-input" type="radio" name="check" id="check2"> <label class="form-check-label" for="check2">합격</label>
				</div>
				<div class="form-check form-check-inline">
					<input class="form-check-input" type="radio" name="check" id="check3"> <label class="form-check-label" for="check3">대기</label>
				</div>
			</div>
			

			<div class='form-group row'>
				<div class='col-sm-10'>
					<button type='button' class='btn btn-primary btn-sm my-new' id="addBtn">등록</button>
					<button type='button' class='btn btn-primary btn-sm my-view' id="updateBtn">변경</button>
					<button type='button' class='btn btn-primary btn-sm my-view' id="deleteBtn">삭제</button>
				</div>
			</div>
		</form>
	</div>

<script src='../node_modules/jquery/dist/jquery.min.js'></script>
<script src='../node_modules/popper.js/dist/umd/popper.min.js'></script>
<script src='../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
<script type="text/javascript" src="../js/context.js"></script>

<script type="text/javascript">
var addBtn = $('#addBtn'),
	updateBtn = $('#updateBtn'),
	deleteBtn = $('#deleteBtn'),
	noItem = $('#no'),
	anoItem = $('#ano'),
	locationItem = $('#location'),
	dateItem = $('#date'),
	prepareItem = $('#prepare'),
	type1Item = $('#type1'),
	type2Item = $('#type2'),
	timeItem = $('#time'),
	typeItem,
	check1Item = $('#check1'),
	check2Item = $('#check2'),
	check3Item = $('#check3'),
	checkItem
	;

var index = location.href.indexOf('?');
var qs = location.href.substr(index + 1);
var checkNo = location.href.indexOf('ano');
var arr = qs.split('=');

if (checkNo == -1) {
	$('.my-new').css('display','none');
	$(() =>{
			
		$.ajax(host + '/json/test/' + arr[1], {
			dataType: 'json',
			success: (result) => {
				if (result.test.type == 0) {
					type1Item.prop('checked', true);
				} else {
					type2Item.prop('checked', true);
				}
				
				if (result.test.check == 0) {
					check1Item.prop('checked', true);
				} else if (result.test.check == 1) {
					check2Item.prop('checked', true);
				} else {
					check3Item.prop('checked', true);
				}
				noItem.val(result.test.no);
				anoItem.val(result.test.apply.ano);
				locationItem.val(result.test.location);
				dateItem.val(result.test.date);
				prepareItem.val(result.test.prepare);
				timeItem.val(result.test.time);
			},
			error: () => {
	            window.alert('서버 실행 오류!');
	        }
		});
	});
	
} else {
	$('.my-view').css('display','none');
	anoItem.val(arr[1]);
	type1Item.prop('checked', true);
}

addBtn.click(() => {
	if ($(type2).is(":checked")) {
		typeItem = 1;
	} else {
		typeItem = 0;
	}
    $.ajax(host + '/json/test/add', {
        data: {
        	ano: anoItem.val(),
    		date: dateItem.val(),
    		time: timeItem.val(),
    		location: locationItem.val(),
    		prepare: prepareItem.val(),
    		type: typeItem
        },
        dataType: 'json',
        method: 'POST',
        success: (result) => {
            location.href = "../apply/form.html?no=" + anoItem.val();
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });	
});

updateBtn.click(() => {
	if ($(type2).is(":checked")) {
		typeItem = 1;
	} else {
		typeItem = 0;
	}
	
	if ($(check1).is(":checked")) {
		checkItem = 0;
	} else if ($(check2).is(":checked")) {
		checkItem = 1;
	} else {
		checkItem = 2;
	}
    $.ajax(host + '/json/test/update', {
        data: {
        	no: noItem.val(),
        	ano: anoItem.val(),
    		date: dateItem.val(),
    		time: timeItem.val(),
    		location: locationItem.val(),
    		prepare: prepareItem.val(),
    		type: typeItem,
    		check: checkItem
        },
        dataType: 'json',
        method: 'POST',
        success: (result) => {
            location.href = "../apply/form.html?no=" + anoItem.val();
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });	
});


deleteBtn.click(() => {
	$.ajax(host + '/json/test/delete', {
		data: {
			no: noItem.val()
		},
		dataType: 'json',
		success: (result) => {
			location.href = "../apply/form.html?no=" + anoItem.val();
		},
		error: () => {
			window.alert('서버 실행 오류!');
		}
	})
})
</script>

</body>
</html>

