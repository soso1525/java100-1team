<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판</title>
<link rel="stylesheet" href="../css/plugin.css">
<link rel="stylesheet" href="../css/style.css">
<link rel="stylesheet" href="../css/apply-modal.css"> 
<link href="https://use.fontawesome.com/releases/v5.0.8/css/all.css"
	rel="stylesheet">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
<style>
body{
background-color: #f2f2f2;
}
</style>
<body>
    <div class='container'>
        <header></header>
        <div class="col-sm-12">
                    <div style="margin: 120px 0 10px 0;" class="section-title">
                        <input readonly id='title' style="background-color: transparent; border:0px; font-size: 30px; text-align: center; width: 1000px">
                        <div class="divider dark">
                            <i class="icon-drop"></i>
                        </div>
                        <input readonly id='name' style="background-color: transparent; border:0px; font-size: 25px; text-align: center">
                    </div>
                </div>

        <div class="col-sm-12">
        <div class="form-group">
        <input type="hidden" id="no" class="form-control my-view"
        placeholder="number">
        </div>
        </div>
        <div style="text-align: center; margin-left: 170px; width: 760px;">
        <div class='contact-us' style="margin:15px;width: 220px; height: 200px; padding: 15px;float: left;">
          <p style="font-size: 25px;">담당업무</p>
          <br>
          <br>
              <input readonly id='duty' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class='contact-us' style="margin:15px; width: 220px; height: 200px; padding: 15px; float: left;">
          <p style="font-size: 25px;">지원자격</p>
          <br>
          <br>
              <input readonly id='nType' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class='contact-us' style="margin:15px;width: 220px; height: 200px; padding: 15px;float: left">
          <p style="font-size: 25px;">모집기간</p>
          <br>
          <br>
              <input readonly id='startDate'
               style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
              <p style="font-size: 18px">~</p>
              <input readonly id='endDate' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class="col-sm-12">
<div align="center" class="textarea-message form-group">
<button id="deleteBtn"
class="button button-style button-style-dark button-style-color-2">스크랩</button>
</div>
</div>
        
        <div class='form-group row'>
            <label for='photo' class='col-sm-2 col-form-label'></label>
            <div class='col-sm-10' id='image' style="width: 784px"></div>
        </div> 
        </div>
        <div class='biew_summary'>
        </div>
            
            <div id='questionForm'>
            </div>
		<div class="col-sm-12">
		<div align="center" class="textarea-message form-group">
		<button id="updateBtn"
		class="button button-style button-style-dark button-style-color-2">Update</button>
		<button id="deleteBtn"
		class="button button-style button-style-dark button-style-color-2">Delete</button>
		</div>
		</div>
		
		
		
		
		<div style="text-align: center">
			<button id="myBtn"
				class="button button-style button-style-dark button-style-color-2">입사
				지원하기</button>
		</div>
		
		<div id="myModal" class="modal">
			<div class="modal-content">
				<span class="close">&times;</span>
				<h2
					style="font-family: 'Poppins', sans-serif; font-weight: 600; font-size: 30px; margin-top: 40px; margin-bottom: 60px">
					회사 지원하기<i style="margin-left: 10px" class="far fa-edit"></i>
				</h2>
				<form method='post' id='form' enctype='multipart/form-data'>
					<div style="font-weight: 700">지원하는 기업 이름</div>
					<input style="margin: 0 0 15px 0" class="form-control" readonly
						id="aname" name="aname" type="text">
	
					<div class="row">
						<div class="col-sm-6">
							<div style="font-weight: 700">접수 시작일</div>
							<input style="margin: 0 0 10px 0" class="form-control" id="lsdt" readonly
								name="lsdt" type="date">
						</div>
	
						<div class="col-sm-6">
							<div style="font-weight: 700">접수 마감일</div>
							<input style="margin: 0 0 10px 0" class="form-control" id="ledt" readonly
								name="ledt" type="date">
						</div>
					</div>
	
					<div style="font-weight: 700">이력서 파일</div>
					<input style="margin: 0 0 15px 0" class="form-control" type="file"
						name="files">
	
					<div style="text-align: center; margin: 50px 0">
						<button id="applyBtn" type="button"
							class="button button-style button-style-dark button-style-color-2">입사
							지원하기</button>
					</div>
				</form>
			</div>
		</div>
    </div>
    <script src='../node_modules/jquery/dist/jquery.min.js'></script>
    <script src='../node_modules/popper.js/dist/umd/popper.min.js'></script>
    <script src='../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>

    <script type="text/javascript">
    $('header').load('../header.html');
var updateBtn = $('#updateBtn'),
    deleteBtn = $('#deleteBtn'),
    noItem = $('#no'), 
    startDateItem = $('#startDate'), 
    endDateItem = $('#endDate'),
    imageItem = $('#image'),
    nodivItem = $('#nodiv'),
    nTypeItem = $('#nType'),
    simgs = $('#image'),
    dutyItem = $('#duty'),
    titleItem = $('#title'),
    nameItem = $('#name');
    
var index = location.href.indexOf('?');
if (index != -1) { // 기존 데이터를 조회할 경우,
    var qs = location.href.substr(index + 1);
    var arr = qs.split('=');
    $('.my-new').css('display', 'none');
    $(() => {
        $.ajax('../json/notice/' + arr[1], {
            dataType: 'json',
            success: (result) => {
               nodivItem.html("<input class='form-control' readonly id='no' " +
                       "name='no' value='" + result.data.no + "'> "); 
                simgs.html("<img src='../../download/" + result.data.image + "'/>");
                noItem.val(result.data.no);
                dutyItem.val(result.data.duty);
                nameItem.val(result.data.companyMember.name);
                startDateItem.val(result.data.startDate);
                endDateItem.val(result.data.endDate);
                imageItem.val(result.data.image);
                nTypeItem.val(result.data.nType);
                titleItem.val(result.data.title);
                nameItem.val(result.data.companyMember.cName);
                $('#aname').val(result.data.companyMember.cName);
                $('#lsdt').val(result.data.startDate);
                $('#ledt').val(result.data.endDate);
                var resultCno = result.data.companyMember.cno;
                var resultPno = result.userInfo;
                console.log("resultCno : "+ resultCno + " resultPno : "+ resultPno + " >>>> ");
                
                if(resultCno == resultPno) {
                    
                } else {
                    updateBtn.css("display","none");
                    deleteBtn.css("display","none");
                }
            },
            error: () => {
                window.alert('서버 실행 오류!');
            }
        });
    });
    
}

var modal = document.getElementById('myModal');
var btn = document.getElementById("myBtn");
var span = document.getElementsByClassName("close")[0];
btn.onclick = function() {
	modal.style.display = "block";
}

span.onclick = function() {
	modal.style.display = "none";
}

window.onclick = function(event) {
	if (event.target == modal) {
		modal.style.display = "none";
	}
}

$('#applyBtn').click(() => {
	var formData = new FormData($('#form')[0]);
    
    $.ajax('../json/apply/add-simple', {
        data:
        	formData,
        	dataType: 'json',
        method: 'POST',
        processData : false,
        contentType : false,
        success: (result) => {
        	console.log('success');
        	modal.style.display = "none";
        	location.href="../apply/my-apply-list.html";
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});

deleteBtn.click(() => {
    $.ajax('../json/notice/delete', {
        data: {
            no: noItem.val()
        },
        dataType: 'json',
        success: (result) => {
            location.href = "notice.html";
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});
</script>

</body>
</html>