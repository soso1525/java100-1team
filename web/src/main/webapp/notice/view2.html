<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판</title>
<link rel='stylesheet' href='../css/common.css'>
<link rel='stylesheet' href='../css/plugin.css'>
<link rel='stylesheet' href='../css/style.css'>
</head>
<style>
body{
background-color: #f2f2f2;
}
</style>
<body>
    <div class='container'>
        <header></header>
        <div class="col-sm-12">
                    <div style="margin: 120px 0 10px 0;" class="section-title">
                        <input readonly id='title' style="background-color: transparent; border:0px; font-size: 30px; text-align: center; width: 1000px">
                        <div class="divider dark">
                            <i class="icon-drop"></i>
                        </div>
                        <input readonly id='name' style="background-color: transparent; border:0px; font-size: 25px; text-align: center">
                    </div>
                </div>

        <form id="form" method='post' enctype="multipart/form-data">
        <div class="col-sm-12">
        <div class="form-group">
        <input type="hidden" id="no" class="form-control my-view"
        placeholder="number">
        </div>
        </div>
        <div style="text-align: center; margin-left: 170px; width: 760px;">
        <div class='contact-us' style="margin:15px;width: 220px; height: 200px; padding: 15px;float: left;">
          <p style="font-size: 25px;">담당업무</p>
          <br>
          <br>
              <input readonly id='duty' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class='contact-us' style="margin:15px; width: 220px; height: 200px; padding: 15px; float: left;">
          <p style="font-size: 25px;">지원자격</p>
          <br>
          <br>
              <input readonly id='nType' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class='contact-us' style="margin:15px;width: 220px; height: 200px; padding: 15px;float: left">
          <p style="font-size: 25px;">모집기간</p>
          <br>
          <br>
              <input readonly id='startDate'
               style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
              <p style="font-size: 18px">~</p>
              <input readonly id='endDate' 
              style="background-color: transparent; border:0px; font-size: 18px; text-align: center">
        </div>
        <div class="col-sm-12">
<div align="center" class="textarea-message form-group">
<button id="applyBtn"
class="button button-style button-style-dark button-style-color-2">지원하기</button>
<button id="scrapBtn"
class="button button-style button-style-dark button-style-color-2">스크랩</button>
</div>
</div>
        
        <div class='form-group row'>
            <label for='photo' class='col-sm-2 col-form-label'></label>
            <div class='col-sm-10' id='image' style="width: 784px"></div>
        </div> 
        </div>
        <div class='biew_summary'>
        </div>
            
            <div id='questionForm'>
            </div>
<div class="col-sm-12">
<div align="center" class="textarea-message form-group">
<button id="updateBtn"
class="button button-style button-style-dark button-style-color-2">Update</button>
<button id="deleteBtn"
class="button button-style button-style-dark button-style-color-2">Delete</button>
</div>
</div>

        </form>
    </div>
    <script src='../node_modules/jquery/dist/jquery.min.js'></script>
    <script src='../node_modules/popper.js/dist/umd/popper.min.js'></script>
    <script src='../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>

    <script type="text/javascript">
    $('header').load('../header.html');
var updateBtn = $('#updateBtn'),
    deleteBtn = $('#deleteBtn'),
    applyBtn = $('#applyBtn'),
    scrapBtn = $('#scrapBtn'),
    noItem = $('#no'), 
    startDateItem = $('#startDate'), 
    endDateItem = $('#endDate'),
    imageItem = $('#image'),
    nodivItem = $('#nodiv'),
    nTypeItem = $('#nType'),
    simgs = $('#image'),
    dutyItem = $('#duty'),
    titleItem = $('#title'),
    questionAddItem = $('#questionAdd'),
    questionDeleteItem = $('#questionDelete'),
    nameItem = $('#name');
    
var index = location.href.indexOf('?');
if (index != -1) { // 기존 데이터를 조회할 경우,
    var qs = location.href.substr(index + 1);
    var arr = qs.split('=');
    $('.my-new').css('display', 'none');
    $(() => {
        $.ajax('../json/notice/' + arr[1], {
            dataType: 'json',
            success: (result) => {
               nodivItem.html("<input class='form-control' readonly id='no' " +
                       "name='no' value='" + result.data.no + "'> "); 
                simgs.html("<img src='../../download/" + result.data.image + "'/>");
                noItem.val(result.data.no);
                dutyItem.val(result.data.duty);
                nameItem.val(result.data.companyMember.name);
                startDateItem.val(result.data.startDate);
                endDateItem.val(result.data.endDate);
                imageItem.val(result.data.image);
                nTypeItem.val(result.data.nType);
                titleItem.val(result.data.title);
                nameItem.val(result.data.companyMember.cName);
                var resultCno = result.data.companyMember.cno;
                var resultPno = result.userInfo;
                console.log("resultCno : "+ resultCno + " resultPno : "+ resultPno + " >>>> ");
                
                if(resultCno == resultPno) {
                    applyBtn.css("display","none");
                    scrapBtn.css("display","none");
                } else {
                    updateBtn.css("display","none");
                    deleteBtn.css("display","none");
                }
            },
            error: () => {
                window.alert('서버 실행 오류!');
            }
        });
    });
    
} else { // 신규 데이터 입력일 경우,
    $('.my-view').css('display', 'none');
    var now = new Date();
    var month = (now.getMonth() + 1);               
    var day = now.getDate();
    if(month < 10) 
        month = "0" + month;
    if(day < 10) 
        day = "0" + day;
    var today = now.getFullYear() + '-' + month + '-' + day;
    console.log(today);
    startDateItem.attr('min', today);
    endDateItem.attr('min', today);
    startDateItem.val(today);
}

startDateItem.change(() => {
    endDateItem.attr('min', startDateItem.val());
});

endDateItem.change(() => {
    startDateItem.attr('max', endDateItem.val());
});

var cnt = 1;
questionAddItem.click(() => {
    if (cnt < 6) {
        var div = $("<div class='form-group row'></div>");
        div.html("<label for='startDate' class='col-sm-2 col-form-label'>문항" + cnt + "</label>" +
        "<div class='col-sm-10'>" +
            "<input class='form-control' type='text' name='articles'>" +
        "</div>");
        $('#questionForm').append(div);
        cnt++;
    }
});

questionDeleteItem.click(() => {
    if (cnt > 0) {
        $('#questionForm > div:last-child').remove();
        cnt--;
    }
});

updateBtn.click(() => {
    var formData = new FormData($('#form')[0]);
    $.ajax('../json/notice/update', {
        data: formData,
        dataType: 'json',
        method: 'POST',
        processData : false,
        contentType : false,
        success: (result) => {
            location.href = "notice.html";
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});
deleteBtn.click(() => {
    $.ajax('../json/notice/delete', {
        data: {
            no: noItem.val()
        },
        dataType: 'json',
        success: (result) => {
            location.href = "notice.html";
        },
        error: () => {
            window.alert('서버 실행 오류!');
        }
    });
});
</script>

</body>
</html>