<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<link rel="stylesheet" type="text/css" href="../css/common.css">
<link rel="stylesheet" type="text/css" href="../css/plugin.css">
<link rel="stylesheet" type="text/css" href="../css/style.css">
<link rel="stylesheet" type="text/css" href="https://tympanus.net/Development/HoverEffectIdeas/fonts/font-awesome-4.2.0/css/font-awesome.min.css" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">
<link rel="stylesheet" type="text/css" href="../css/notice.css">
<body>
<header></header>
	<section id="portfolio" class="portfolio section-space-padding">
		<div class="container">
			<div class="row">
				<div class="col-sm-12">
					<div class="section-title">
						<h2>채용정보</h2>
						<div class="divider dark">
							<i class="icon-picture"></i>
						</div>
						<p><a href="form.html">
					<button type="button" class='btn btn-primary btn-sm'>공고등록</button>
				</a></p>
					</div>
				</div>
			</div>
			<div class="col-sm-12 search">
	            <div class="col-sm-12">
	            	<div class="col-sm-3">
	            		<strong>What</strong>
	            	</div>
	            	<div class="col-sm-3">
	            		<strong>Occupation</strong>
	            	</div>
	            	<div class="col-sm-3">
	            		<strong>Where</strong>
	            	</div>
	            </div>
	            
	            <div class="col-sm-12">
					<form>
						<div class="col-sm-3">
							<input name="words" id="words" class="form-control form-control-sm mr-sm-2"
								type="search" placeholder="Keyword" aria-label="Search"> 
						</div>
						<div class="col-sm-3">
							<select id="cKind" name="cKind" class="form-control form-control-sm mr-sm-2">
								<option>전체</option>
								<option>건설</option>
								<option>경영/사무</option>
								<option>교육</option>
								<option>디자인</option>
								<option>미디어</option>
								<option>서비스</option>
								<option>생산/제조</option>
								<option>IT/인터넷</option>
								<option>영업/고객상담</option>
								<option>유통/무역</option>
								<option>의료</option>
								<option>전문직</option>
								<option>특수계층/공공</option>
							</select> 
						</div>
						<div class="col-sm-3">
							<select id="address" name="address" class="form-control form-control-sm mr-sm-2">
								<option>전체</option>
								<option>강남구</option>
								<option>강동구</option>
								<option>강북구</option>
								<option>강서구</option>
								<option>관악구</option>
								<option>광진구</option>
								<option>구로구</option>
								<option>금천구</option>
								<option>노원구</option>
								<option>도봉구</option>
								<option>동대문구</option>
								<option>동작구</option>
								<option>마포구</option>
								<option>서대문구</option>
								<option>서초구</option>
								<option>성동구</option>
								<option>성북구</option>
								<option>송파구</option>
								<option>양천구</option>
								<option>영등포구</option>
							</select>
						</div>
						<div class="col-sm-2" style="width:8%;">
							<label class="switch">
							  <input id="nType" type="checkbox">
							  <span class="slider round"></span>
							</label>
							<strong class="my-check">신입</strong><strong class="my-check" style="display:none;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;경력</strong>
						</div>
						<div class="col-sm-2">
							<button style="margin-left: 10px" class="button search button-style button-style-dark button-style-color-2" type="button" id="searchBtn">Catch</button>
						</div>
					</form>
				</div>
			</div>
			<div class="my-main">
				<div class="col-md-12">
					<ul class="portfolio">
						<li class="filter" data-filter=".apps" data-order="viewcount">Hot</li>
						<li class="filter" data-filter=".mockups" data-order="later">Best</li>
						<li class="filter" data-filter=".wordpress" data-order="startdate">New</li>
					</ul>
				</div>
				<div class="col-xs-12">
					<div id='list' class="portfolio-inner margin-top-30">
						<div id="hot" class="mix apps" ></div>
						<div id="best" class="mix mockups" ></div>
						<div id="new" class="mix wordpress" ></div>
					</div>
				</div>
			</div>
			<div id="modal-testNew" class="modal fade" tabindex="-1" role="dialog"
		     aria-labelledby="테스트정보 등록" aria-describedby="테스트 모달">
		    <div class="modal-dialog" style="width: 800px; height: 500px">
			    <div class="modal-content"></div>
				</div>
			</div>
			<div class="notice-list">
				<strong style="font-size:20	px; margin-left: 80px;">채용정보 검색</strong>
				<ul id="searchList">
				</ul>
			</div>
		</div>
	</section>
<script id="noticeList" type="text/x-handlebars-template">
{{#each list}}
<li>
	<div class="notice-head">
		<img class="notice-img-top" src='../../download/{{companyMember.logo}}' alt="Card image cap">
	</div>
	<div class="notice-body">
  		<p class="notice-title">{{companyMember.cName}}</p><br>
  		<p class="notice-text">{{duty}}</p><br>
		<div class="notice-footer">
			<p class="notice-text">{{d-day}}</p><br>
		</div>
	</div>
</li>
{{/each}}
</script>



	<script id="notice" type="text/x-handlebars-template">
{{#each list}}
<div class="col-md-4 col-sm-6 col-xs-12" >
    <class="portfolio-popup">
    <div class="grid">
    <figure class="effect-apollo">
    <img src="../../download/{{companyMember.logo}}" alt=""/>
    <figcaption>
    <h2>{{companyMember.cName}} <span></span></h2>
    <p>{{startDate}} ~ <br>{{endDate}}</p>
    <a data-toggle='modal' href='view.html' onclick="show('{{no}}')" data-target='#modal-testNew' role='button' data-backdrop='static'>
    <div class='services-detail' style='cursor:pointer'> 
    <i class='icon-screen-smartphone color-1'></i>
    <h5></h5>
    <hr>
    </div>
    </a>
    </figcaption>           
    </figure>
    </div>
    </div>
    </div>
</div>
{{/each}}
</script>

<script src='../node_modules/handlebars/dist/handlebars.min.js'></script>
<script type="text/javascript" src="../js/jquery.min.js"></script>
<script type="text/javascript" src="../js/plugin.js"></script>
<script type="text/javascript" src="../js/scripts.js"></script>
<script src='../js/context.js'></script>
<script type="text/javascript">
$('header').load("../header.html");

var check = $("input[type='checkbox']");
check.click(function(){
  $(".my-check").toggle();
});

var prevBtn = $('#prevBtn'),
  	currBtn = $('#currBtn'),
  	nextBtn = $('#nextBtn'),
  	words = $('#words'),
	searchBtn = $('#searchBtn'),
	listItem = $('#searchList'),
   	currPageNo = 1,
 	noticeListSrc = $('#noticeList').html(),
 	nTypeItem = $('#nType'),
 	noticeListEngine = Handlebars.compile(noticeListSrc);

searchBtn.click(() => {
	$(".my-main").css('display', 'none');
	$(".notice-list").css('display', 'block');
	var nType = 0;
	if (nTypeItem.prop("checked")) {
		nType = 1;
	}
    listload(1, {
        "words": words.val(),
        "cKind": $('#cKind option:selected').text(),
        "address": $('#address option:selected').text(),
        "nType": nType
    })
});


prevBtn.click(() => {
    listload(currPageNo - 1)
});

nextBtn.click(() => {
    listload(currPageNo + 1)
});

/* D-DAY구하는 함수 */
function parse(str) {
	var now = new Date();
	var date = new Date(str.split('-'));
	var dday = date.getTime() - now.getTime();
	dday = Math.floor(dday / (1000 * 60 * 60 * 24)) + 1;
	if (dday <= 0) {
		return "D-Day";
	}
	return "D-" + dday;
}


Handlebars.registerHelper('d-day', function(options){
    return parse(this.endDate);
});


function listload(pageNo, options) {
     if (options == undefined) options = {};
     options.pn = pageNo;
    
    $.ajax(host + '/json/notice/list', {
    	data: options,
        dataType: 'json',
        success: (result) => {
            listItem.html(noticeListEngine(result));
            currPageNo = result.pageNo;
            currBtn.html(currPageNo);
            if (result.pageNo == 1) {
                $(prevBtn.parent()).addClass("disabled");
            } else {
                $(prevBtn.parent()).removeClass("disabled");
            }
            
            if (result.lastPageNo == result.pageNo) {
                $(nextBtn.parent()).addClass("disabled");
            } else {
                $(nextBtn.parent()).removeClass("disabled");
            }
       },
       error: () => {
            window.alert('서버 실행 오류!');
       } 
    }); 
}

</script>

<script type="text/javascript">
	$('header').load("../header.html");
    var index = -1;
    $(".notice-list").css('display', 'none');
    $('#modal-testNew').on('hidden.bs.modal', () => {
    })
    
    noticeSrc = $('#notice').html(),
    noticeEngine = Handlebars.compile(noticeSrc);
    // load('viewcount', 'wordpress');
    
    function view( v ) {
    	console.log ('yes ', v);
	    $.ajax ( {
	    	url : '/json/notice/' + v,
	    	dataType: 'json',
	    	success ( res ) {
	    		console.log ( res );
	    		var img = '../../download/' + res.data.image;
	    		$('#image').html('<img src={} style="height:500px"/>'.replace('{}', img));
	    		
	    	}
	    })
    }
    
    function show(value) {
        $('#modal-testNew').on('shown.bs.modal', (event) => {
            view(value);
        });
    }
    
    function load(orderType, panelId) {
    	   /*  if (options == undefined) options = {};
    	     options.pn = pageNo; */
    	    
    	    $.ajax(host + '/json/notice/list', {
    	        dataType: 'json',
    	        data : {oc : orderType},
    	        success: (result) => {
    	        	var html = noticeEngine(result);
    	            $('#list ' + panelId ).html(html); // '#list #new' 
    	            
    	         /*    currPageNo = result.pageNo;
    	            currBtn.html(currPageNo);
    	            
    	            if (result.pageNo == 1) {
    	                $(prevBtn.parent()).addClass("disabled");
    	            } else {
    	                $(prevBtn.parent()).removeClass("disabled");
    	            }
    	            
    	            if (result.lastPageNo == result.pageNo) {
    	                $(nextBtn.parent()).addClass("disabled");
    	            } else {
    	                $(nextBtn.parent()).removeClass("disabled");
    	            } */
    	        },
    	        error: () => {
    	            window.alert('서버 실행 오류!');
    	        }
    	    });
    	}
    
/*     var index = location.href.indexOf('?');
    if (index != -1) { // 기존 데이터를 조회할 경우,
        var qs = location.href.substr(index + 1);
        var arr = qs.split('=');
        $('.my-new').css('display', 'none');
        $(() => {
            $.ajax('../json/notice/' + arr[1], {
                dataType: 'json',
                success: (result) => {
                    tbody.html(noticeEngine(result)); 
                },
                error: () => {
                    window.alert('서버 실행 오류!');
                }
            });
        });  */
        $('.filter').on('click', function(e){ 
        	var ot = $(e.target).data('order');
        	var panel = $(e.target).data('filter');
        	load ( ot, panel );
        });	
    </script>

</body>
</html>