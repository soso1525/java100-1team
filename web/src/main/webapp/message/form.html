<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CATCH : message</title>
<!-- <link rel='stylesheet'
	href='../node_modules/bootstrap/dist/css/bootstrap.min.css'> -->
<link rel='stylesheet' href='../css/common.css'>
<link rel="shortcut icon" href="../images/favicon/favicon.ico">
<link rel="apple-touch-icon" sizes="144x144" type="image/x-icon"
	href="../images/favicon/apple-touch-icon.png">
<link rel="stylesheet" type="text/css" href="../css/plugin.css">
<link rel="stylesheet" type="text/css" href="../css/style.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/css?family=Poppins:400,300,500,600,700">
</head>
<body>
	<div class='container'>

		<header></header>
		<form method='get'>
			<div id='nod'></div>
			<section id="contact" class="section-space-padding">
				<div class="container">
					<div class="row">
						<div class="col-sm-12">
							<div class="section-title">
								<h2>Contact Me.</h2>
								<div class="divider dark">
									<i class="icon-envelope-open"></i>
								</div>
								<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit</p>
							</div>
						</div>
					</div>


					<div class="margin-top-30 margin-bottom-50">
						<div class="row">

							<div class="col-md-offset-3 col-sm-offset-2 col-md-6 col-sm-8">

								<div class="row">
									<form class="contact-us pattern-bg">

										<div class="col-sm-12">
											<div class="form-group">
												<input type="hidden" id="mno" class="form-control my-view"
													placeholder="number">
											</div>
										</div>
										<div class="col-sm-12">
											<div class="form-group">
												<input type="text" id="msend" class="form-control my-view"
													placeholder="Your Name">
											</div>
										</div>
										<div class="col-sm-12">
											<div class="form-group">
												<input type="text" id="mrecv" class="form-control"
													placeholder="Your Name">
											</div>
										</div>
										<div class="col-sm-12">
											<div class="form-group">
												<input type="text" id="mdt" class="form-control my-view"
													placeholder="Your Name">
											</div>
										</div>
										<div class="col-sm-12">
											<div class="textarea-message form-group">
												<textarea id="mcont" class="textarea-message form-control"
													placeholder="Your Message" rows="5"></textarea>
											</div>
										</div>

										<div class="col-sm-12">
											<div align="center" class="textarea-message form-group">
												<button id="addBtn" type="submit"
													class="button button-style button-style-dark button-style-color-2 my-new">Submit</button>
											</div>
										</div>

										<div class="col-sm-12">
											<div align="center" class="textarea-message form-group">
												<button id="deleteBtn" type="submit"
													class="button button-style button-style-dark button-style-color-2 my-view">Delete</button>
											</div>
										</div>
									</form>

								</div>
							</div>
						</div>


					</div>
				</div>
			</section>
		</form>
	</div>

	<script src='../node_modules/jquery/dist/jquery.min.js'></script>
	<script src='../node_modules/popper.js/dist/umd/popper.min.js'></script>
	<script src='../node_modules/bootstrap/dist/js/bootstrap.min.js'></script>
	<script src="../js/jquery.min.js"></script>
	<script src="../js/plugin.js"></script>
	<!-- Main Javascript File  -->
	<script src="../js/scripts.js"></script>

	<script type="text/javascript">
	$('header').load("../header.html");
	var addBtn = $('#addBtn'),
	deleteBtn = $('#deleteBtn'),
	msendItem = $('#msend'),
	mnoItem = $('#mno'),
	mrecvItem = $('#mrecv'),
	pidItem = $('#pid'),
	mdtItem = $('#mdt'),
	mcontItem = $('#mcont'),
	nodiv = $('#nod')
	;

 	    var index = location.href.indexOf('?');
	    if (index != -1) { // 기존 데이터를 조회할 경우,
	        var qs = location.href.substr(index + 1);
	        var arr = qs.split('=');
	        $('.my-new').css('display', 'none');
	        $(() => {
	            $.ajax('../json/msg2/' + arr[1], {
	                dataType: 'json',
	                success: (result) => {
	                    mnoItem.val(result.data.mno);
	                    msendItem.val(result.data.pid1);
	                    mrecvItem.val(result.data.pid2);
	                    mdtItem.val(result.data.mdt);
	                    mcontItem.val(result.data.mcont);
	                },
            error: () => {
                /* window.alert('서버 실행 오류!'); */
            	location.href = "sendList.html";
            }
        });
    });
    
} else { // 신규 데이터 입력일 경우,
    $('.my-view').css('display', 'none');
}
	    
addBtn.click(() => {
    $.ajax('../json/msg2/add', {
        data: {
            mrecv: mrecvItem.val(),
            mcont: mcontItem.val()
        },
        dataType: 'json',
        method: 'POST',
        success: (result) => {
        	
            location.href = "sendList.html";
        },
        error: () => {
            /* window.alert('서버 실행 오류!!'); */
            location.href = "sendList.html";
        }
    });
});


deleteBtn.click(() => {
    $.ajax('../json/msg2/delete', {
        data: {
            mno: mnoItem.val()
        },
        dataType: 'json',
        success: (result) => {
            location.href = "receiveList.html";
        },
        error: () => {
            /* window.alert('서버 실행 오류!!!'); */
            location.href="sendList.html";
        }
    });
});

</script>
</body>
</html>