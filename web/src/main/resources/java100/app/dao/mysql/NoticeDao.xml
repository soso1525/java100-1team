<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- DAO 객체를 자동으로 생성하려면,
     namespace의 값이 인터페이스 이름과 같아야 한다. -->
<mapper namespace="java100.app.dao.NoticeDao">

	<!--
	 member m = new member();
	 m.setEmail ( rs.getString("pmail");
	 m.setId ( rs.getString(" 
	 -->
    <resultMap type="notice" id="noticeMap">
        <id column="nno" property="no"/>
        <result column="nimg" property="image"/>
        <result column="nsdt" property="startDate"/>
        <result column="nedt" property="endDate"/>
        <result column="ncnt" property="viewCount"/>
    
	    <association property="companyMember" javaType="companyMember" >
	    	<id column="cno" property="no"/>
	    	<result column="cname" property="name"/>
	    	<result column="clogo" property="logo"/>
	    </association>
   
    </resultMap>

    <select id="findAll" resultMap="noticeMap" parameterType="map">
		select
			n.nno,
			n.nimg,
			n.nsdt,
			n.nedt,
			n.ncnt,
			c.cname,
			c.clogo
		from g_noti n
		left join g_corp c on n.cno=c.cno
		
		<if test="words != null">
       <where>
           <foreach collection="words" item="word">
               or n.ncnt like '${word}%'
           </foreach>
       </where>
       </if>
       order by
       <choose>
           <when test="orderColumn == 'n.ncnt' and align == 'asc'">
               n.ncnt asc
           </when>
           <otherwise>
               n.ncnt desc
           </otherwise>
       </choose>
		
	</select>
	
	<select id="findByNo" resultMap="noticeMap" parameterType="int">
        select
			n.nno,
			n.nimg,
			n.nsdt,
			n.nedt,
			n.ncnt,
			c.cname,
			c.clogo
		from g_noti n
		left join g_corp c on n.cno=c.cno
		where n.nno = #{no}
    </select>
	
	<insert id="insert" parameterType="notice"
		useGeneratedKeys="true" keyColumn="no" keyProperty="no">
        insert into g_noti(nimg, nsdt, nedt, ncnt, cno)
        values(#{image}, #{startDate}, #{endDate}, 0, #{writer.no})
    </insert>
    
    <update id="updateViewCount" parameterType="int">
        update g_noti set 
            ncnt=ncnt + 1
        where nno=#{value}
        
    </update>
    
    <update id="update" parameterType="notice">
    	update g_noti set
    		nimg = #{image},
    		nsdt = #{startDate},
    		nedt = #{endDate}
        where nno=#{no}
    </update>
    
    <delete id="delete" parameterType="int">
        delete from g_noti
        where nno=#{value}
    </delete>
    
</mapper>  









